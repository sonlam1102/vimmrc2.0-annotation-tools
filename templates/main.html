<html>
<head>
    <title>ViRACE Annotating tools</title>
    <script type="text/javascript"
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
    <script type="text/javascript"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm">
            <div class="form-group">
                <label for="comment">Tiêu đề:</label>
                <input type="text" class="form-control" id="title">
            </div>
        </div>

        <div class="col-sm">
            <div class="form-group">
                <label for="comment">Tác giả:</label>
                <input type="text" class="form-control" id="author">
            </div>
        </div>

        <div class="col-sm">
            <div class="form-group">
                <label for="inputState">Lớp: </label>
                <select id="grade" class="form-control">
                    <option selected>Choose...</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-sm">
            <div class="form-group">
                <label for="comment">Nội dung:</label>
                <textarea class="form-control" rows="5" id="passage"></textarea>
            </div>
        </div>

        <div class="form-group">
            <div class="form-group">
                <label for="comment">Thể loại:</label>
                <div>
                    <div class="form-check form-check">
                        <input class="form-check-input" type="radio" name="passage_type" value="văn bản">
                        <label class="form-check-label" for="inlineRadio1">Thơ</label>
                    </div>
                    <div class="form-check form-check">
                        <input class="form-check-input" type="radio" name="passage_type" value="thơ">
                        <label class="form-check-label" for="inlineRadio2">Văn bản</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm">
            <div class="form-group">
                <label for="comment">Câu hỏi:</label>
                <input type="text" class="form-control" id="question">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm answers_group">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">A</span>
                </div>
                <input type="text" id="option1" class="form-control answers" placeholder="Câu trả lời A" def="A">
            </div>

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">B</span>
                </div>
                <input type="text" id="option2" class="form-control answers" placeholder="Câu trả lời B" def="B">
            </div>

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">C</span>
                </div>
                <input type="text" id="option3" class="form-control answers" placeholder="Câu trả lời C" def="C">
            </div>

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">D</span>
                </div>
                <input type="text" id="option4" class="form-control answers" placeholder="Câu trả lời D" def="D">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-9">
            <label for="inputState">Câu trả lời đúng: </label>
            <select id="right_answer" class="form-control">
                <option selected>Choose...</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
            </select>
        </div>

        <div class="form-group reasoning_types">
            <label for="comment">Loại suy diễn:</label>
            <div>
                <div class="form-check form-check">
                    <input class="form-check-input" type="radio" name="reasoning_type" id="rs1">
                    <label class="form-check-label" for="inlineRadio1">Word matching</label>
                </div>
                <div class="form-check form-check">
                    <input class="form-check-input" type="radio" name="reasoning_type" id="rs2">
                    <label class="form-check-label" for="inlineRadio2">Paraphrasing</label>
                </div>
                <div class="form-check form-check">
                    <input class="form-check-input" type="radio" name="reasoning_type" id="rs3">
                    <label class="form-check-label" for="inlineRadio2">Single-sentence reasoning</label>
                </div>
                <div class="form-check form-check">
                    <input class="form-check-input" type="radio" name="reasoning_type" id="rs4">
                    <label class="form-check-label" for="inlineRadio2">Multi-sentence reasoning</label>
                </div>
                <div class="form-check form-check">
                    <input class="form-check-input" type="radio" name="reasoning_type" id="rs5">
                    <label class="form-check-label" for="inlineRadio2">Ambiguous/Insufficient</label>
                </div>
            </div>
        </div>
    </div>

    <div class="btn-group col-md-9" role="group" aria-label="Basic example">
        <button type="button" class="btn btn-secondary" id="prev">Trước đó</button>
        <button type="button" class="btn btn-secondary" id="next">Kế tiếp</button>
    </div>

    <div class="btn-group" role="group" aria-label="Basic example">
        <button type="button" class="btn btn-secondary" id="load" onclick="openFile(dispFile)">Load data</button>
        <button type="button" class="btn btn-secondary" id="export">Export data</button>
    </div>
</div>
</body>
<label id="ques" hidden></label>
<label id="ques_index" hidden></label>
<label id="ques_number" hidden></label>
</html>
<script>
    function dispFile(contents) {
        {#document.getElementById('contents').innerHTML = contents;#}
        let data = JSON.parse(contents);

        console.log(data);

        $("#title").val(data['title']);
        $("#author").val(data['author']);
        $("#passage").val(data['content']);
        $("#grade option[value="+data['grade']+"]").attr('selected','selected');

        $("#ques_index").val(0);
        $("#ques").val(JSON.stringify(data['questions']));
        $("#ques_number").val(data['questions'].length);


        $("#question").val(JSON.parse($("#ques").val())[$("#ques_index").val()]['question']);

        let options = JSON.parse($("#ques").val())[$("#ques_index").val()]['options'];

        for (let i = 0; i < options.length; i++) {
            $("#option"+(i+1)).val(Object.entries(options[i])[0][1]);
        }

        $("#right_answer option[value="+JSON.parse($("#ques").val())[$("#ques_index").val()]['answer']+"]").attr('selected','selected');

        let types = JSON.parse($("#ques").val())[$("#ques_index").val()]['types'];
        for(let i = 0; i < types.length; i++) {
            $("#rs"+(i+1)).attr('checked', Object.entries(types[i])[0][1]);
        }

    }

    function clickElem(elem) {
        // Thx user1601638 on Stack Overflow (6/6/2018 - https://stackoverflow.com/questions/13405129/javascript-create-and-save-file )
        var eventMouse = document.createEvent("MouseEvents")
        eventMouse.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null)
        elem.dispatchEvent(eventMouse)
    }

    function openFile(func) {
        readFile = function (e) {
            var file = e.target.files[0];
            if (!file) {
                return;
            }
            var reader = new FileReader();
            reader.onload = function (e) {
                var contents = e.target.result;
                fileInput.func(contents);
                document.body.removeChild(fileInput)
            };
            reader.readAsText(file)
        };
        fileInput = document.createElement("input");
        fileInput.type = 'file';
        fileInput.style.display = 'none';
        fileInput.onchange = readFile;
        fileInput.func = func;
        document.body.appendChild(fileInput);
        clickElem(fileInput);
    }

    $(document).ready(function () {
        let data = [];

        $("#export").click(function () {
            console.log(data);
        });

        $("#next").click(function () {
            let curr = $("#ques_index").val();
            curr = parseInt(curr) + 1;

            let ques = $("#ques").val();
            let ques_number = parseInt($("#ques_number").val());

            if (curr < ques_number) {
                $("#question").val(JSON.parse(ques)[curr]['question']);

                let options = JSON.parse(ques)[curr]['options'];

                for (let i = 0; i < options.length; i++) {
                    $("#option"+(i+1)).val(Object.entries(options[i])[0][1]);
                }

                $("#right_answer option[value="+JSON.parse(ques)[curr]['answer']+"]").attr('selected','selected');

                let types = JSON.parse(ques)[curr]['types'];
                for(let i = 0; i < types.length; i++) {
                    $("#rs"+(i+1)).attr('checked', Object.entries(types[i])[0][1]);
                }

                $("#ques_index").val(curr);
            }
        });

        $("#prev").click(function () {
            let curr = $("#ques_index").val();
            curr = parseInt(curr) - 1;

            let ques = $("#ques").val();
            let ques_number = parseInt($("#ques_number").val());

            if (curr >= 0) {
                $("#question").val(JSON.parse(ques)[curr]['question']);

                let options = JSON.parse(ques)[curr]['options'];

                for (let i = 0; i < options.length; i++) {
                    $("#option"+(i+1)).val(Object.entries(options[i])[0][1]);
                }

                $("#right_answer option[value="+JSON.parse(ques)[curr]['answer']+"]").attr('selected','selected');

                let types = JSON.parse(ques)[curr]['types'];
                for(let j = 0; j < types.length; j++) {
                    $("#rs"+(j+1)).attr('checked', Object.entries(types[j])[0][1]);
                }

                $("#ques_index").val(curr);
            }
        });
    });
</script>